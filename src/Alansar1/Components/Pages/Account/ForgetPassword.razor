@page "/oldforgot-password"
@using Alansar1.Components.Layout
@layout AuthLayout
@inject HttpClient Http
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<MudContainer MaxWidth="MaxWidth.Medium" Class="pa-4">
    <MudGrid Justify="Justify.Center">
        <MudItem xs="12" sm="8" md="8">
            <MudPaper Class="pa-6">
                <MudText Typo="Typo.h4" Class="mb-4" Align="Align.Center">Forgot Password</MudText>
                <MudText Typo="Typo.body1" Class="mb-4" Align="Align.Center">
                    Enter your email address to receive a password reset link.
                </MudText>
                <EditForm Model="resetModel" OnValidSubmit="HandlePasswordReset">
                    <DataAnnotationsValidator />
                    <ValidationSummary />

                    <MudTextField Label="Email"
                                  @bind-Value="resetModel.Email"
                                  Required="true"
                                  Class="mb-2"
                                  FullWidth="true" />

                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               ButtonType="ButtonType.Submit"
                               Class="mt-4"
                               Disabled="@isLoading"
                               FullWidth="true">
                        @if (isLoading)
                        {
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                        }
                        else
                        {
                            @:Send Reset Link
                        }
                    </MudButton>
                </EditForm>
                <MudLink Href="/login" Class="d-block mt-4">Back to Login</MudLink>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>


@code {
    private ResetModel resetModel = new ResetModel();
    private bool isLoading = false;

    private async Task HandlePasswordReset()
    {
        isLoading = true;
        var response = await Http.PostAsJsonAsync("api/Auth/forgot-password", resetModel);
        isLoading = false;

        if (response.IsSuccessStatusCode)
        {
            Snackbar.Add("Password reset link sent. Please check your email.", Severity.Success);
            Navigation.NavigateTo("/login");
        }
        else
        {
            Snackbar.Add("Failed to send reset link. Please try again.", Severity.Error);
        }
    }

    public class ResetModel
    {
        public string Email { get; set; }
    }
}
